<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 4. Асинхронность в Javascript</title>
</head>

<body>
    <script>
        // Event loop
        console.log('start long calculation');

        setTimeout(function timeout() {
            console.log('This will be printed after 5 second');
        }, 5000);

        console.log('End');
        // for (let i = 0; i < 100000000; i++) {
        //     const newDate = new Date(i);
        // }
        // console.log('End long calculation');

        // ------------- Метод Get ----------------- 

        // const xhr = new XMLHttpRequest();

        // xhr.open('GET', 'https:/api.github.com/users/octocat');

        // xhr.send();

        // xhr.onload = function() {
        //     if (xhr.status != 200) {
        //         console.log(`Error ${xhr.status}: ${xhr.statusText}`);
        //     } else {
        //         console.log(`User: ${xhr.response}`);
        //     }
        // }

        // xhr.onprogress = function (event) {
        //     console.log(`Get from server ${event.loaded} bytes`);
        // }; 

        // xhr.onerror = function (){
        //     console.log('Request error');
        // }

        // xhr.abort();

        // ------------- Метод Post -----------------  


        const formData = new FormData();
        formData.append('name', 'Slava');
        formData.append('surname', 'Belkin');

        const xhr = new XMLHttpRequest();

        xhr.open('POST', 'https:/httpbin.org/post');
        xhr.send(formData);

        xhr.onload = function () {
            if (xhr.status != 200) {
                console.log(`Error ${xhr.status}: ${xhr.statusText}`);
            } else {
                console.log(`user: ${xhr.response}`);
            }
        }

        xhr.onprogress = function (event) {
            console.log(`Get from server: ${event.loaded} bytes`);
        }

        xhr.onerror = function () {
            console.log('Request error');
        }

        // AJAX 
        // Технология которая позволяет сделать асинхронный запрос к серверу для получения данных в Виде XML разметки. !!! Без перезагрузки страницы !!!

        // Объект -> JSON 

        const student = {
            name: 'Slava',
            surname: 'Belkin',
            age: 20,
            practice: {
                place: 'IKTG',
                hours: 47,
            }
        };

        console.log(JSON.stringify(student, null, 4));

        // ----------- async/await -----------

        const getUser = async (url) => {
            const response = await fetch(url);
            const user = await response.text();
            console.log(user);
        }

        getUser('https:/api.github.com/users/octocat');
        
    </script>

</body>

</html>